version: 2.1
jobs:
  checkout_src:
    docker:
      - image: mcr.microsoft.com/dotnet/core/sdk:2.1
    working_directory: ~/project # default directory
    steps:
      - checkout
      - persist_to_workspace:
          root: . # absolute or relative path to the working directory
          paths: . # reference to the current working directory
  build:
    docker:
      - image: mcr.microsoft.com/dotnet/core/sdk:2.1
    steps:
      - attach_workspace:
          at: . # where to attach the workspace at relative to the working directory
      - run:
          name: List Directory
          command: ls
      - run:
          name: Build App
          command: |
            dotnet restore
            dotnet publish -r linux-x64 -c Release -o build
      - run:
          name: List Directory
          command: ls
      - persist_to_workspace:
          root: . # attach the workspace in the working directory
          paths: ./build # copy the newly created build directory into the workspace
  ls:
    docker:
      - image: mcr.microsoft.com/dotnet/core/sdk:2.1
    steps:
      - attach_workspace:
          at: . # attach the workspace in the working directory
      - run:
          name: List Directory
          command: ls
workflows:
  version: 2
  build:
    jobs:
      - checkout_src:
          filters:
            branches:
              only:
                workspaces
      - build:
          requires:
            - checkout_src
      - ls:
          requires:
            - build